{% extends 'base.html' %} {% block content %} {% load static %}
<div id="register">
	<div class="grid">
		<div class="row">
			<h1 class="title">Đăng ký để sử dụng dịch vụ</h1>
		</div>
	</div>
	<div class="grid">
		<div class="form-wrapper row">
			<div class="col-lg-6">
				<form action="" method="" id="form" class="row">
					<div class="form-group col-lg-12">
						<input
							type="text"
							name="fullname"
							id="fullname"
							placeholder="Tên đầy đủ"
						/>
						<p class="form-message"></p>
					</div>
					<div class="form-group col-lg-12">
						<input
							type="text"
							name="phone-number"
							id="phone-number"
							placeholder="Số điện thoại"
						/>
						<p class="form-message"></p>
					</div>
					<div class="form-group col-lg-12">
						<input
							type="text"
							name="student-code"
							id="student-code"
							placeholder="Mã sinh viên"
						/>
						<p class="form-message"></p>
					</div>
					<div class="form-group col-lg-12">
						<span class="form-group-label">Ngày sinh</span>
						<input type="date" id="birthday" name="birthday"
							value="2003-01-01">
					</div>
					<div class="form-group-gender col-lg-12">
						<span class="form-group-label">Giới tính</span>
						<span class="gender-group">
							<label for="male">Nam</label>
							<input
								type="radio"
								value="male"
								name="gender"
								id="male"
							/>
						</span>
						<span class="gender-group">
							<label for="female">Nữ</label>
							<input
								type="radio"
								value="female"
								name="gender"
								id="female"
							/>
						</span>
					</div>
					{% comment %} <div id="camera" class="form-group-img col-lg-12">
						<span class="form-group-label" id="camera-placeholder"
							>Chụp vài tấm hình khuôn mặt của bạn</span
						>
						<img 
							srcset="{% static 'faceregister/img/image-placeholder.png' %}"
							alt=""
						/> 
						<div id="overlay" class="overlay">chụp vài bức hình</div>
					</div> {% endcomment %}
					{% comment %} <button type='button' name='taking-picture-btn' id='taking-picture-btn'></button> {% endcomment %}
					
				</form>
			</div>
		</div>
	</div>
	<div class="grid">
		<div class="policy-wrapper row">
			<div class="col-lg-6">
				<p class="policy">
					Bằng cách click đăng ký bạn sẽ đồng ý với
					<span class="policy--primary">chính sách</span> và
					<span class="policy--primary">điều khoản</span> của chúng tôi
				</p>
			</div>
		</div>
	</div>
	<div class="grid">
		<div class="row">
			<button id="signup">Đăng ký</button>
		</div>
	</div>
</div>
<div class="alert-green hide">
	<span class="fas fa-check-circle"></span>
	<span class="msg">Succeed!</span>
	<div class="close-btn-green">
		<span class="fas fa-times"></span>
	</div>
</div>

<div class="alert-red hide">
	<span class="fas fa-times-circle"></span>
	<span class="msg">Failed!</span>
	<div class="close-btn-red">
		<span class="fas fa-times"></span>
	</div>
</div>
<!-- The Modal -->
<div id="myModal" class="modal">
	<div class="modal-content">
	  <div class="modal-content1">
		<div class="noti-percent">
		  <div class="noti_index" style="font-size: 20px;" ></div>
		</div>
		<div class = "noti-green">
		  <div class="fas fa-check-circle"></div>
		  <div class = "hello"></div>
		</div>
		<div class = "noti-red">
		  <div class="fas fa-times-circle"></div>
		  <div class="noti-alert">Định danh thất bại</div>
		</div>
		<div class="close ">
			<span class="fas fa-times" ></span>
		</div>
	  </div>
  
	</div>
  </div>
<script src="{% static 'faceregister/js/validate.js' %}"></script>
<!-- <script src="{% static 'faceregister/js/signup.js' %}"></script> -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
	const signupBtn = document.querySelector('#signup')
const modal = document.getElementById("myModal");
const modalcontent = document.querySelector(".modal-content1");
const noti_percent = document.querySelector(".noti-percent");
const noti_alert = document.querySelector(".noti-alert");
console.log("hello");
//thông báo
function Alertgreen() {
  console.log("hell")
  const alert = document.querySelector(".alert-green");
  const closebtn = document.querySelector(".close-btn-green");
  alert.classList.add("show");
  alert.classList.remove("hide");
  alert.classList.add("showAlert");
  
  alert.style.display = "block";
  setTimeout(function () {
    alert.classList.remove("show");
    alert.classList.add("hide");
    setTimeout(function () {
      alert.style.display = "none";
    }, 1000);
  }, 1000);
  closebtn.onclick = () => {
    alert.classList.remove("show");
    alert.classList.add("hide");
    setTimeout(function () {
      alert.style.display = "none";
    }, 1000);
  };
}
async function callSignUpAPI(data){
  const config = {
      method: 'POST',
      url: '/faceregister/takingfrontalface/',
      headers: { 
      //   'Authorization': 'Token c148eaabe85be02995148063c5c3b61dd1558a63', 
        'Content-Type': 'application/json'
      },
      data : data
    };
    
  axios(config)
  .then(function (response) {
    console.log(JSON.stringify(response.data));
    Alertgreen();
  })
  .catch(function (error) {
    console.log(error);
    console.log(error.response);
    console.log(error.response.data);
    // for (const key in error.response.data){
    //   console.log(`${key}: ${error.response.data[key]}`);
    //   const noti = document.createElement("p")
    //   noti.innerHTML = `${key}: ${error.response.data[key]}`  
    //   notification.appendChild(noti);
    //   notification.appendChild(document.createElement("br"))
    // }
    // for(let i = 0; i<error.response.data.length; i++){
    //   notification.appendChild(document.createElement("p").innerHTML 
    //                             = error.response.data[i])
    // }
  });
}

signupBtn.onclick = () => {
    const fullName = document.querySelector('#fullname').value
    const phoneNumber = document.querySelector('#phone-number').value
    const studentCode = document.querySelector('#student-code').value
    const birthday = document.querySelector('#birthday').value
    const maleGender = document.querySelector('#male')
    console.log("click")
    const data = JSON.stringify({
        "masv": studentCode,
        "ho_ten": fullName,
        "nam_sinh": birthday,
        "so_dien_thoai": phoneNumber,
        "gioi_tinh": maleGender.checked
    });
    
      callSignUpAPI(data)
      
}



</script>
{% endblock content %}
